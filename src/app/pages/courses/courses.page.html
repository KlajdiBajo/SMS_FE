<ion-content>
  <div class="courses">
    <!-- Header -->
    <div class="courses__header ion-padding">
      <div>
        <h1 class="courses__title">Courses</h1>
        <p class="courses__subtitle">Manage your school's courses</p>
      </div>
      <ion-button
        color="primary"
        (click)="openAddForm()"
        class="courses__add-btn"
      >
        <ion-icon name="add" slot="start"></ion-icon>
        Add Course
      </ion-button>
    </div>

    <app-search-bar
      [(value)]="searchTerm"
      placeholder="Search courses by code, title, or description..."
      (valueChange)="onSearchChange()"
    ></app-search-bar>

    <!-- Courses Grid -->
    <div class="courses__grid">
      <ion-card *ngFor="let course of filteredCourses" class="courses__card">
        <ion-card-header class="card__header">
          <div class="course-info">
            <div>
              <ion-card-title class="courses__card-name">
                {{ course.title }}
              </ion-card-title>
              <p class="courses__card-code">{{ course.code }}</p>
            </div>
          </div>
        </ion-card-header>
        <ion-card-content>
          <div class="courses__card-details">
            <p><strong>Description:</strong> {{ course.description }}</p>
            <p><strong>Year:</strong> {{ course.year }}</p>
            <p *ngIf="course.teacher">
              <strong>Teacher:</strong>
              {{ course.teacher.title }} {{ course.teacher.firstName }} {{
              course.teacher.lastName }}
            </p>
            <p *ngIf="!course.teacher"><strong>Teacher:</strong> None</p>
          </div>
          <div class="courses__card-actions">
            <ion-button
              fill="outline"
              size="small"
              (click)="openDetails(course)"
            >
              <ion-icon name="eye" slot="start"></ion-icon>
              View
            </ion-button>
            <ion-button
              fill="outline"
              size="small"
              (click)="openEditForm(course)"
            >
              <ion-icon name="create" slot="start"></ion-icon>
              Edit
            </ion-button>
            <ion-button
              color="danger"
              fill="outline"
              size="small"
              (click)="handleDeleteCourse(course.id)"
            >
              <ion-icon name="trash" slot="start"></ion-icon>
              Delete
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <div *ngIf="filteredCourses.length === 0" class="courses__no-results">
      <ion-icon name="book-outline" class="no-results-icon"></ion-icon>
      <p>No courses found matching your search.</p>
    </div>

    <!-- Pagination Controls -->
    <div
      class="courses__pagination"
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
      "
    >
      <ion-button (click)="goToFirstPage()" [disabled]="isFirst"
        >1st page</ion-button
      >
      <ion-button (click)="goToPreviousPage()" [disabled]="isFirst"
        >Previous</ion-button
      >
      <span>Page {{ currentPage + 1 }} / {{ totalPages }}</span>
      <ion-button (click)="goToNextPage()" [disabled]="isLast">Next</ion-button>
    </div>

    <!-- Course Form Modal -->
    <app-course-form
      [course]="editingCourse"
      [isOpen]="showForm"
      (formSubmit)="editingCourse ? handleEditCourse($event) : handleAddCourse($event)"
      (cancel)="closeForm()"
    >
    </app-course-form>

    <!-- Course Details Modal -->
    <app-course-details
      [course]="selectedCourse"
      [isOpen]="showDetails"
      (close)="closeDetails()"
      (edit)="openEditForm($event)"
      (delete)="handleDeleteCourse($event)"
      (associateTeacher)="handleAssociateTeacher($event)"
      (removeTeacher)="handleRemoveTeacher($event)"
    >
    </app-course-details>
  </div>
</ion-content>
