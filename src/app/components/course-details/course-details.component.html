<div
  *ngIf="isOpen && course"
  class="course-details-backdrop"
  (click)="onClose()"
>
  <ion-card class="course-details-card" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="course-details-header">
      <ion-button fill="clear" class="close-button" (click)="onClose()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
      <div class="avatar">
        {{ course.code }}
      </div>
      <h1 class="course-name">{{ course.title }}</h1>
    </div>

    <!-- Content -->
    <div class="course-details-content">
      <div class="detail-section">
        <!-- Course Code -->
        <div class="detail-item">
          <p class="detail-label">Course Code</p>
          <p class="detail-value">{{ course.code }}</p>
        </div>

        <!-- Description -->
        <div *ngIf="course.description" class="detail-item">
          <p class="detail-label">Description</p>
          <p class="detail-value">{{ course.description }}</p>
        </div>

        <!-- Year -->
        <div class="detail-item">
          <p class="detail-label">Year</p>
          <p class="detail-value">{{ course.year }}</p>
        </div>

        <!-- Teacher -->
        <div class="detail-item">
          <p class="detail-label">Assigned Teacher</p>
          <div *ngIf="course.teacher; else noTeacher" class="teacher-info">
            <p class="teacher-name">
              {{ course.teacher.title }} {{ course.teacher.firstName }}
              {{ course.teacher.lastName }}
            </p>
            <ion-button
              size="small"
              fill="outline"
              color="danger"
              (click)="showRemoveTeacherConfirm = course.teacher.id"
            >
              <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
            </ion-button>
          </div>
          <ng-template #noTeacher>
            <p class="no-teachers">No teacher assigned</p>
          </ng-template>
          <ion-button
            size="small"
            fill="outline"
            (click)="openTeacherModal()"
            class="add-teacher-btn"
            [disabled]="!!course.teacher"
          >
            <ion-icon name="add-outline" slot="start"></ion-icon>
            Add Teacher
          </ion-button>
        </div>
      </div>
    </div>
  </ion-card>
</div>

<!-- Teacher Association Modal -->
<div
  *ngIf="showTeacherModal"
  class="modal-backdrop"
  (click)="showTeacherModal = false"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add Teacher to Course</h3>
    </div>
    <div class="modal-body">
      <div
        *ngIf="unassignedTeachers.length > 0; else allAssigned"
        class="teachers-list"
      >
        <div
          *ngFor="let teacher of unassignedTeachers"
          class="teacher-item"
          (click)="onAssociateTeacher(teacher.id)"
        >
          <div class="teacher-info">
            <p class="teacher-name">
              {{ teacher.title }} {{ teacher.firstName }} {{ teacher.lastName }}
            </p>
          </div>
        </div>
      </div>
      <ng-template #allAssigned>
        <p>All available teachers are already assigned to this course.</p>
      </ng-template>
    </div>
    <div class="modal-actions">
      <ion-button fill="outline" (click)="showTeacherModal = false"
        >Cancel</ion-button
      >
    </div>
  </div>
</div>

<!-- Remove Teacher Confirmation Modal -->
<div
  *ngIf="showRemoveTeacherConfirm"
  class="modal-backdrop"
  (click)="showRemoveTeacherConfirm = null"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Remove Teacher</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to remove this teacher from the course?</p>
    </div>
    <div class="modal-actions">
      <ion-button fill="outline" (click)="showRemoveTeacherConfirm = null"
        >Cancel</ion-button
      >
      <ion-button color="danger" (click)="onRemoveTeacher()">Remove</ion-button>
    </div>
  </div>
</div>
