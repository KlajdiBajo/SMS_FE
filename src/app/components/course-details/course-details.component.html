<div
  *ngIf="isOpen && course"
  class="course-details-backdrop"
  (click)="onClose()"
>
  <ion-card class="course-details-card" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="course-details-header">
      <ion-button fill="clear" class="close-button" (click)="onClose()">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>

      <div class="avatar">
        {{ course.code }}
      </div>
      <h1 class="course-name">{{ course.name }}</h1>
      <p class="course-department">{{ course.department }}</p>
    </div>

    <!-- Content -->
    <div class="course-details-content">
      <div class="detail-section">
        <!-- Course Code -->
        <div class="detail-item">
          <p class="detail-label">Course Code</p>
          <p class="detail-value">{{ course.code }}</p>
        </div>

        <!-- Description -->
        <div *ngIf="course.description" class="detail-item">
          <p class="detail-label">Description</p>
          <p class="detail-value">{{ course.description }}</p>
        </div>

        <!-- Credits -->
        <div class="detail-item">
          <p class="detail-label">Credits</p>
          <p class="detail-value">{{ course.credits }}</p>
        </div>

        <!-- Duration -->
        <div class="detail-item">
          <p class="detail-label">Duration</p>
          <p class="detail-value">{{ course.duration }}</p>
        </div>

        <!-- Capacity -->
        <div class="detail-item">
          <p class="detail-label">Enrollment</p>
          <p class="detail-value">
            {{ course.enrolledStudents }}/{{ course.capacity }}
          </p>
        </div>

        <!-- Status -->
        <div class="detail-item">
          <p class="detail-label">Status</p>
          <span
            [class]="
              'detail-value status-badge ' + getStatusClass(course.status)
            "
          >
            {{ capitalize(course.status) }}
          </span>
        </div>

        <!-- Teachers -->
        <div class="detail-item">
          <p class="detail-label">Assigned Teachers</p>
          <div
            *ngIf="course.teachers.length > 0; else noTeachers"
            class="teachers-list"
          >
            <div *ngFor="let teacher of course.teachers" class="teacher-item">
              <div class="teacher-info">
                <p class="teacher-name">{{ teacher.name }}</p>
                <p class="teacher-details">
                  {{ teacher.department }} - {{ teacher.subject }}
                </p>
              </div>
              <ion-button
                size="small"
                fill="outline"
                color="danger"
                (click)="showRemoveTeacherConfirm = teacher.id"
              >
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </div>
          </div>
          <ng-template #noTeachers>
            <p class="no-teachers">No teachers assigned</p>
          </ng-template>

          <ion-button
            size="small"
            fill="outline"
            (click)="showTeacherModal = true"
            class="add-teacher-btn"
            [disabled]="course.teachers.length >= 1"
          >
            <ion-icon name="add-outline" slot="start"></ion-icon>
            Add Teacher
          </ion-button>
        </div>
      </div>
    </div>
  </ion-card>
</div>

<!-- Teacher Association Modal -->
<div
  *ngIf="showTeacherModal"
  class="modal-backdrop"
  (click)="showTeacherModal = false"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Add Teacher to Course</h3>
    </div>
    <div class="modal-body">
      <div
        *ngIf="unassignedTeachers.length > 0; else allAssigned"
        class="teachers-list"
      >
        <div
          *ngFor="let teacher of unassignedTeachers"
          class="teacher-item"
          (click)="onAssociateTeacher(teacher.id)"
        >
          <div class="teacher-info">
            <p class="teacher-name">{{ teacher.name }}</p>
            <p class="teacher-details">{{ teacher.department }}</p>
          </div>
        </div>
      </div>
      <ng-template #allAssigned>
        <p>All available teachers are already assigned to this course.</p>
      </ng-template>
    </div>
    <div class="modal-actions">
      <ion-button fill="outline" (click)="showTeacherModal = false"
        >Cancel</ion-button
      >
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div
  *ngIf="showDeleteConfirm"
  class="modal-backdrop"
  (click)="showDeleteConfirm = false"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Confirm Delete</h3>
    </div>
    <div class="modal-body">
      <p>
        Are you sure you want to delete this course? This action cannot be
        undone.
      </p>
    </div>
    <div class="modal-actions">
      <ion-button fill="outline" (click)="showDeleteConfirm = false"
        >Cancel</ion-button
      >
      <ion-button color="danger" (click)="onDelete()">Delete</ion-button>
    </div>
  </div>
</div>

<!-- Remove Teacher Confirmation Modal -->
<div
  *ngIf="showRemoveTeacherConfirm"
  class="modal-backdrop"
  (click)="showRemoveTeacherConfirm = null"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Remove Teacher</h3>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to remove this teacher from the course?</p>
    </div>
    <div class="modal-actions">
      <ion-button fill="outline" (click)="showRemoveTeacherConfirm = null"
        >Cancel</ion-button
      >
      <ion-button
        color="danger"
        (click)="onRemoveTeacher(showRemoveTeacherConfirm)"
        >Remove</ion-button
      >
    </div>
  </div>
</div>
